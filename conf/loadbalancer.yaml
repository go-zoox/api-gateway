version: v1

port: 8080

healthcheck:
  outer:
    enable: true
    path: /healthz
    ok: true
  inner:
    enable: true
    interval: 30
    timeout: 5

# 默认后端（单服务模式，向后兼容）
backend:
  service:
    protocol: https
    name: default-backend.example.com
    port: 443

routes:
  # 示例 1: Round-Robin 负载均衡
  - name: round-robin-service
    path: /api/round-robin
    backend:
      service:
        algorithm: round-robin
        servers:
          - name: server1.example.com
            port: 8080
          - name: server2.example.com
            port: 8080
          - name: server3.example.com
            port: 8080
        health_check:
          enable: true
          method: GET
          path: /health
          status: [200]
          interval: 30
          timeout: 5

  # 示例 2: Weighted 负载均衡
  - name: weighted-service
    path: /api/weighted
    backend:
      service:
        algorithm: weighted
        servers:
          - name: server1.example.com
            port: 8080
            weight: 1    # 接收 25% 的流量
          - name: server2.example.com
            port: 8080
            weight: 2    # 接收 50% 的流量
          - name: server3.example.com
            port: 8080
            weight: 1    # 接收 25% 的流量
        health_check:
          enable: true
          path: /health
          interval: 30
          timeout: 5

  # 示例 3: Least Connections 负载均衡
  - name: least-connections-service
    path: /api/least-connections
    backend:
      service:
        algorithm: least-connections
        servers:
          - name: server1.example.com
            port: 8080
          - name: server2.example.com
            port: 8080
        health_check:
          enable: true
          path: /health
          interval: 30
          timeout: 5

  # 示例 4: IP Hash 负载均衡（会话保持）
  - name: ip-hash-service
    path: /api/session
    backend:
      service:
        algorithm: ip-hash
        servers:
          - name: server1.example.com
            port: 8080
          - name: server2.example.com
            port: 8080
        health_check:
          enable: true
          path: /health
          interval: 30
          timeout: 5

  # 示例 5: 混合配置（全局配置 + 实例级别覆盖）
  - name: mixed-config-service
    path: /api/mixed
    backend:
      service:
        algorithm: round-robin
        servers:
          # 实例 1: 使用全局配置
          - name: server1.example.com
            port: 8080
          
          # 实例 2: 覆盖部分配置
          - name: server2.example.com
            port: 8080
            request:
              headers:
                X-Instance: server-2
            health_check:
              path: /custom-health  # 覆盖全局健康检查路径
        
        # 全局配置
        request:
          headers:
            X-Service: mixed-service
            X-API-Version: v1
          query:
            api_key: secret-key
        response:
          headers:
            X-Powered-By: api-gateway
        health_check:
          enable: true
          path: /health
          interval: 30
          timeout: 5

  # 示例 6: 临时禁用某个实例
  - name: maintenance-service
    path: /api/maintenance
    backend:
      service:
        algorithm: round-robin
        servers:
          - name: server1.example.com
            port: 8080
          - name: server2.example.com
            port: 8080
            disabled: true  # 临时禁用，不接收流量
          - name: server3.example.com
            port: 8080

  # 示例 7: 单服务模式（向后兼容）
  - name: single-service
    path: /api/single
    backend:
      service:
        name: single-backend.example.com
        port: 8080
        protocol: https
